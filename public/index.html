<!DOCTYPE html>
<html>

<head>
	<title>Vaccine Availability Alert</title>
	<link rel="stylesheet" type="text/css" href="style.css">
	<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
	<link rel="stylesheet" href="https://unpkg.com/flickity@2/dist/flickity.min.css">
	<link rel="stylesheet" href="style_slider2.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
</head>

<body onload="onloadFunction()">

	<div class="review-show">
		<div class="carausel" data-flickity='{"wrapAround": true, "autoPlay": true}'>
			<!-- <div class="caraousel-cell"> -->
				<img class="w3-image" src="booking_slip.JPG" width="500" height="400">
			<!-- </div> -->
			<!-- <div class="caraousel-cell"> -->
				<img class="w3-image" src="gurgaon.jpg" width="400" height="200">
			<!-- </div> -->
			<!-- <div class="caraousel-cell"> -->
					<img class="w3-image" src="bangalore.jpg" width="400" height="200">
				<img class="w3-image" src="meerut.jpg" width="400" height="200">
			<!-- </div> -->
			<!-- <div class="caraousel-cell"> -->

			<!-- </div> -->
			<img class="w3-image" src="ranchi.jpg" width="395" height="150">

			<img class="w3-image" src="gujarat.jpg" width="395" height="200">

			<img class="w3-image" src="pune.jpg" width="395" height="200">
		</div>
	</div>

	<div class="registration-space">

		<div class="registration-form">



			<h2>Get Notified for Vaccine Availability, So Easily !</h2><br>
			<form name="passpin" action="#" method="post">
				<button type="button" id="togglebuttonPin" name="Toggle" onclick="toggleCheckPin()">Register By
					District</button>
				<button type="button" id="togglebuttonDistrict" name="Toggle" onclick="toggleCheckDistrict()">Register
					By Pin</button>
				<div id="district">
					<p>State:<p>
							<select id="StateSelect" name="StateSelect" placeholder="State"
								onchange="selectDistrict(this.value)">
								<option value="" selected disabled hidden>Select State</option>
								<option value="1">Andaman and Nicobar Islands</option>
								<option value="2">Andhra Pradesh</option>
								<option value="3">Arunachal Pradesh</option>
								<option value="4">Assam</option>
								<option value="5">Bihar</option>
								<option value="6">Chandigarh</option>
								<option value="7">Chhattisgarh</option>
								<option value="8">Dadra and Nagar Haveli</option>
								<option value="37">Daman and Diu</option>
								<option value="9">Delhi</option>
								<option value="10">Goa</option>
								<option value="11">Gujarat</option>
								<option value="12">Haryana</option>
								<option value="13">Himachal Pradesh</option>
								<option value="14">Jammu and Kashmir</option>
								<option value="15">Jharkhand</option>
								<option value="16">Karnataka</option>
								<option value="17">Kerala</option>
								<option value="18">Ladakh</option>
								<option value="19">Lakshadweep</option>
								<option value="20">Madhya Pradesh</option>
								<option value="21">Maharashtra</option>
								<option value="22">Manipur</option>
								<option value="23">Meghalaya</option>
								<option value="24">Mizoram</option>
								<option value="25">Nagaland</option>
								<option value="26">Odisha</option>
								<option value="27">Puducherry</option>
								<option value="28">Punjab</option>
								<option value="29">Rajasthan</option>
								<option value="30">Sikkim</option>
								<option value="31">Tamil Nadu</option>
								<option value="32">Telangana</option>
								<option value="33">Tripura</option>
								<option value="34">Uttar Pradesh</option>
								<option value="35">Uttarakhand</option>
								<option value="36">West Bengal</option>
							</select>
							<p>District:<p>
									<select id="DistSelect" name="DistSelect" placeholder="District"
										disabled="disabled">
										<option value="" selected disabled hidden>Select District</option>
										<option></option>
									</select>
				</div>
				<div id="pincode">
					<p>Pin Code:</p>
					<input type="text" name="pincode" id="pin" placeholder="Pincode">
				</div>
				<p>Email:</p>
				<input type="email" name="email" id="email" placeholder="Email Id">
				<p>Age Limit</p>
				<select id="Age_Limit" name="Age_Limit" placeholder="Age-Limit">
					<option value="" selected disabled hidden>Choose Age</option>
					<option value="18">18-45</option>
					<option value="45">45+</option>
				</select><br>

				<p><input type="radio" id="Dose1" name="dose" value="Dose1" onclick="disableCheck()">Dose1</p>
				<p><input type="radio" id="Dose2" name="dose" value="Dose2" onclick="disableCheck()">Dose2</p>
				<select id="Vaccine" name="Vaccine" placeholder="Vaccine" disabled="disabled">
					<option value="" selected disabled hidden>Choose Vaccine For Dose2</option>
					<option value="COVAXIN">Covaxin</option>
					<option value="COVISHIELD">Covishield</option>
				</select><br>

				<p>Mobile No (Optional)<p>
						<div class="alert_msg">(Do not enter any pefix like +91 or 0)</div><br>
						<input type="tel" name="mobile" id="mobile" placeholder="Mobile-No" pattern="[0-9]{10}">
						<br><br>
						<div id="message"></div>
						<button type="button" onclick="getVaccineDetails()" id="subscribe">Subscribe</button>
						<button type="button" onclick="removeVaccineDetails()" id="unsubscribe">Unsubscribe</button>
			</form>
		</div>

		<div class="extra-details" align="center">
			<br>
			<h2>Rate your experience!!</h2>
			<div class="container">
				<div class="post" id="post">
					<div class="text"> Thanks for rating us!</div>
				</div>
				<div class="star-widget">
					<input type="radio" name="rate" id="rate-5">
					<label for="rate-5" class="fas fa-star"></label>
					<input type="radio" name="rate" id="rate-4">
					<label for="rate-4" class="fas fa-star"></label>
					<input type="radio" name="rate" id="rate-3">
					<label for="rate-3" class="fas fa-star"></label>
					<input type="radio" name="rate" id="rate-2">
					<label for="rate-2" class="fas fa-star"></label>
					<input type="radio" name="rate" id="rate-1">
					<label for="rate-1" class="fas fa-star"></label>
					<form action="#" method="post">
						<header></header>
						<div style="margin: 10px 0px" class="email-review" align="left">
							<h3>Email:</h3>
							<input style="display:block;width:100%" type="email" name="email" id="email-review" placeholder="Email Id">
						</div>
						<div class="textarea">
							<textarea id="review" cols="30" placeholder="Describe your experience.."></textarea>
						</div><br />
						<div class="status" id="reviewStatus"></div>
						<div class="btn">
							<button type="button" id="btnReview" onclick="postReview()">Post</button>
						</div>
					</form>
				</div>
			</div>

			<div class="user_count" id="user_count">

			</div>

			<div class="contact-details">

				<!-- <br><br><br>

				<br>
				<br> -->
				<div class="feedback">
					<a href="mailto:cowislot@gmail.com">Contact us here for any Feedback </a>
				</div>
			</div>

		</div>

	</div>


	<script>

		//const btn = document.querySelector("button");
		//const post = document.querySelector(".post");

		function onloadFunction() {
			console.log("Loading page");
			var div = document.getElementById('district');
			var div2 = document.getElementById('pincode');
			div.style.display = 'none';
			div2.style.display = 'block';
		}

		async function postReview(){
			var star;
		const btn = document.getElementById("btnReview");
		const post = document.querySelector(".post");
		const widget = document.querySelector(".star-widget");
		const editBtn = document.querySelector(".edit");
		const reviewStatus=document.getElementById("reviewStatus");
			const review_email=document.getElementById("email-review").value;
			const review=document.getElementById("review").value;
			console.log(review_email);
			console.log(document.getElementById("rate-5").checked);

			if(document.getElementById("rate-1").checked){
				star=1;
			}
			else if(document.getElementById("rate-2").checked){
				star=2;
			}
			else if(document.getElementById("rate-3").checked){
				star=3;
			}
			else if(document.getElementById("rate-4").checked){
				star=4;
			}
			else if(document.getElementById("rate-5").checked){
				star=5;
			}
			console.log("star "+star);
			if(star!=undefined && review_email!='' && review!=''){
			const review_url = `validEmail/${review_email}:${review}:${star}`;
			console.log(review_url);
			const response_review = await fetch(review_url);
			 const data_review =  await response_review.json();
			 console.log(data_review);
			 if(data_review.color=="green"){
					document.getElementById('reviewStatus').innerHTML = "<span style='color: white;'>Thanks for reviewing!</span>";
					document.getElementById("review").value="";
					document.getElementById("email-review").value="";
			// widget.style.display = "none";
			// post.style.display = "block";
			// return false;
		}
		else if(data_review.color=="red"){
			console.log("Not yet subscribed");
			document.getElementById('reviewStatus').innerHTML = "<span style='color: red;'>You are not yet subscribed</span>";
		}
	}
	else{
		console.log("Please fill all details");
		document.getElementById('reviewStatus').innerHTML = "<span style='color: red;'>Please fill alll details</span>";
	}
}



		function toggleCheckPin() {
			var div = document.getElementById('pincode');
			var div2 = document.getElementById('district');
			var btnPin = document.getElementById("togglebuttonPin");
			var btnDistrict = document.getElementById("togglebuttonDistrict");
			div.style.display = 'none';
			div2.style.display = 'block';
			btnPin.style.backgroundColor = "#F08080";
			btnDistrict.style.backgroundColor = "";
		};

		function toggleCheckDistrict() {
			var div = document.getElementById('district');
			var div2 = document.getElementById('pincode');
			var btnPin = document.getElementById("togglebuttonPin");
			var btnDistrict = document.getElementById("togglebuttonDistrict");
			div.style.display = 'none';
			div2.style.display = 'block';
			btnPin.style.backgroundColor = "";
			btnDistrict.style.backgroundColor = "#F08080";
		};

		async function displayCount() {

			const count_url = `count/`;
			const response_count = await fetch(count_url);
			const count_data = await response_count.json();
			console.log(count_data.count);
			var display_msg = "Number of Subscriptions : " + "\n" + count_data.count;
			document.getElementById('user_count').innerHTML = "<span style='color: white;'>" + display_msg + "</span>";
			document.getElementById('user_count').style.fontSize = "x-large";
			document.getElementById('user_count').style.boxShadow = "10px 20px 30px white";

		}


		async function selectDistrict(value) {
			document.getElementById("DistSelect").disabled = true;
			var i, distOptions = "";
			console.log(value);

			const district_url = `district/${value}`
			console.log(district_url);

			const response = await fetch(district_url);
			const district_data = await response.json();
			//console.log(district_data);

			for (i = 0; i < district_data.length; i++) {
				dist_id = district_data[i].District_Id;
				dist_name = district_data[i].District_Name;
				distOptions += "<option value=" + dist_id + ">" + dist_name + "</option>";
			}
			if (distOptions != "") {
				document.getElementById("DistSelect").innerHTML = distOptions;
				document.getElementById("DistSelect").disabled = false;
			}
		}


		function disableCheck() {
			var x = document.getElementById("Vaccine");
			if (document.getElementById('Dose1').checked) {
				x.value = "";
				x.disabled = true;
			}
			else if (document.getElementById('Dose2').checked) {
				x.disabled = false;
			}

			return;
		}


		function validateData(email, mob, dose) {
			var valid = 1, ind1 = 1, ind2 = 1, ind3 = 1, ind4 = 1;
			var mailformat = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
			var mob_format = /^\d{10}$/;
			var vaccine = document.getElementById("Vaccine").value;

			if (!(email.match(mailformat))) {
				document.getElementById('message').innerHTML = "<span style='color: red;'>Please enter a valid email address</span>";
				ind1 = 0;
			}

			else if (!(mob.match(mob_format)) && mob.length != 0) {
				document.getElementById('message').innerHTML = "<span style='color: red;'>Please enter a valid Mobile Number</span>";
				ind2 = 0;
			}

			else if (dose == undefined) {
				document.getElementById('message').innerHTML = "<span style='color: red;'>Please select a dose</span>";
				ind3 = 0;
			}

			else if (dose == "Dose2" && vaccine == "") {
				document.getElementById('message').innerHTML = "<span style='color: red;'>Please select a vaccine for Dose2</span>";
				ind4 = 0;
			}

			if (ind1 == 0 || ind2 == 0 || ind3 == 0 || ind4 == 0) {
				valid = 0;
			}
			return valid;
		}

		function validateDataRemove(email) {
			var valid = 1, ind1 = 1, ind2 = 1, ind3 = 1;
			var mailformat = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
			var mob_format = /^\d{10}$/;

			if (!(email.match(mailformat))) {
				document.getElementById('message').innerHTML = "<span style='color: red;'>Please enter a valid email address</span>";
				ind1 = 0;
			}

			// else if(pin==undefined){
			// 	document.getElementById('message').innerHTML="<span style='color: red;'>Please enter a pin</span>";
			// 	ind3=0;
			// }

			if (ind1 == 0) {
				valid = 0;
			}
			return valid;
		}

		async function removeVaccineDetails() {
			const pin = document.getElementById('pin').value;
			//console.log(pin);
			const mob = document.getElementById('mobile').value;
			const email = document.getElementById('email').value;
			const age = document.getElementById('Age_Limit').value;
			var today = new Date();
			var month_today = (today.getMonth() + 1);
			console.log(month_today);
			if ((month_today.toString().length) < 2) {
				month_today = "0" + month_today.toString();
			}
			console.log(month_today);
			var date_today = today.getDate() + '-' + month_today + '-' + today.getFullYear();
			var dose;
			if (document.getElementById('Dose1').checked) {
				dose = document.getElementById('Dose1').value;
			}
			else if (document.getElementById('Dose2').checked) {
				dose = document.getElementById('Dose2').value;
			}
			const remove_url = `unsubscribe/${pin},${mob},${email},${age},${dose}`
			console.log(remove_url);

			var valid = validateDataRemove(email);
			console.log('Valid:' + valid);
			if (valid == 1) {
				if (email != '' && age != '') {
					const response = await fetch(remove_url);
					const data_remove = await response.json();
					console.log(data_remove.message)
					color = data_remove.color;

					if (color == 'red') {
						document.getElementById('message').innerHTML = "<span style='color: red;'>" + data_remove.message + "</span>";
					}
					else {
						document.getElementById('message').innerHTML = "<span style='color: white;'>" + data_remove.message + "</span>";
						document.getElementById('pin').value = '';
						document.getElementById('email').value = '';
						document.getElementById('Age_Limit').value = '';
						document.getElementById('mobile').value = '';
					}
				}
				else {
					document.getElementById('message').innerHTML = "<span style='color: red;'>**Please fill your Email & Age</span>";
				}
			}
		}


		async function getVaccineDetails() {
			//console.log('inside function');
			const dist = document.getElementById("DistSelect").value;



			console.log(dist == "");

			if (dist == "") {

				const pin = document.getElementById('pin').value;
				const mob = document.getElementById('mobile').value;
				//const date=document.getElementById('date').value;
				//const date1= date.substring(8,10)+'-'+date.substring(5,7)+'-'+date.substring(0,4);
				const email = document.getElementById('email').value;
				const age = document.getElementById('Age_Limit').value;
				var dose;
				if (document.getElementById('Dose1').checked) {
					dose = document.getElementById('Dose1').value;
				}
				else if (document.getElementById('Dose2').checked) {
					dose = document.getElementById('Dose2').value;
				}
				console.log(dose);
				const vaccine = document.getElementById("Vaccine").value;
				console.log(vaccine == "");
				var today = new Date();
				var month_today = (today.getMonth() + 1);
				//console.log(month_today);
				if ((month_today.toString().length) < 2) {
					month_today = "0" + month_today.toString();
				}
				console.log(month_today);
				var date_today = today.getDate() + '-' + month_today + '-' + today.getFullYear();

				var valid = validateData(email, mob, dose);
				//console.log('Valid:'+valid);
				if (valid == 1) {
					//const api_url='https://cdn-api.co-vin.in/api/v2/appointment/sessions/public/calendarByPin?pincode='+pin+'&date='+date1;
					const api_url = `vaccine/${pin},${mob},${email},${age},${dose},${vaccine}`;
					console.log(document.getElementById('pin').value);
					//console.log(document.getElementById('date').value);
					console.log(date_today);
					console.log(api_url);
					console.log(pin == '');
					console.log(email == '');
					console.log(age == '');
					console.log(date_today == '');

					if (pin != '' && email != '' && age != '') {
						const response = await fetch(api_url);
						const data1 = await response.json();
						console.log(data1.message)
						color = data1.color;

						if (color == 'red') {
							document.getElementById('message').innerHTML = "<span style='color: red;'>" + data1.message + "</span>";
							document.getElementById('Vaccine').value = '';
						}
						else {
							document.getElementById('message').innerHTML = "<span style='color: white;'>" + data1.message + "</span>";
							document.getElementById('pin').value = '';
							document.getElementById('email').value = '';
							document.getElementById('Age_Limit').value = '';
							document.getElementById('mobile').value = '';
							document.getElementById('Vaccine').value = '';
						}
					}
					else {
						document.getElementById('message').innerHTML = "<span style='color: red;'>**Please fill in all the details</span>";
					}
					//const data1 = await response.json();
					//console.log(data1);
				}
			}
			else {
				console.log("district handle");
				const x = document.getElementById("DistSelect");
				const dist_name = x.options[x.selectedIndex].text;
				console.log("District selected " + dist_name);
				const mob = document.getElementById('mobile').value;
				//const date=document.getElementById('date').value;
				//const date1= date.substring(8,10)+'-'+date.substring(5,7)+'-'+date.substring(0,4);
				const email = document.getElementById('email').value;
				const age = document.getElementById('Age_Limit').value;
				var dose;
				if (document.getElementById('Dose1').checked) {
					dose = document.getElementById('Dose1').value;
				}
				else if (document.getElementById('Dose2').checked) {
					dose = document.getElementById('Dose2').value;
				}
				console.log(dose);
				const vaccine = document.getElementById("Vaccine").value;
				console.log("Vaccine null" + vaccine == "");
				var today = new Date();
				var month_today = (today.getMonth() + 1);
				//console.log(month_today);
				if ((month_today.toString().length) < 2) {
					month_today = "0" + month_today.toString();
				}
				console.log(month_today);
				var date_today = today.getDate() + '-' + month_today + '-' + today.getFullYear();

				var valid = validateData(email, mob, dose);

				if (valid == 1) {
					//const api_url='https://cdn-api.co-vin.in/api/v2/appointment/sessions/public/calendarByPin?pincode='+pin+'&date='+date1;
					const api_url = `vaccine_dist/${dist},${mob},${email},${age},${dose},${vaccine},${dist_name}`;
					//console.log(document.getElementById('pin').value);
					//console.log(document.getElementById('date').value);
					console.log(date_today);
					console.log(api_url);
					//console.log(pin=='');
					console.log(email == '');
					console.log(age == '');
					console.log(date_today == '');

					if (dist != '' && email != '' && age != '') {
						const response = await fetch(api_url);
						const data1 = await response.json();
						console.log(data1.message)
						color = data1.color;

						if (color == 'red') {
							document.getElementById('message').innerHTML = "<span style='color: red;'>" + data1.message + "</span>";
							document.getElementById('Vaccine').value = '';
						}
						else {
							document.getElementById('message').innerHTML = "<span style='color: white;'>" + data1.message + "</span>";
							document.getElementById("DistSelect").value = "";
							document.getElementById('email').value = '';
							document.getElementById('Age_Limit').value = '';
							document.getElementById('mobile').value = '';
							document.getElementById('Vaccine').value = '';
						}
					}
					else {
						document.getElementById('message').innerHTML = "<span style='color: red;'>**Please fill in all the details</span>";
					}
				}
			}
		}
	</script>
	<script type="application/json" src="https://cdnjs.cloudfare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script src="https://unpkg.com/flickity@2/dist/flickity.pkgd.min.js"></script>
</body>

</html>
